<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="ä¸»è¦ä»‹ç»K-meansï¼ŒEMç®—æ³•å’ŒKNN ç®—æ³•ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="èšç±»ç®—æ³•çš„æ€»ç»“">
<meta property="og:url" content="http://yoursite.com/2020/04/18/cluster_algorithm/index.html">
<meta property="og:site_name" content="Jijeng&#39;s blog">
<meta property="og:description" content="ä¸»è¦ä»‹ç»K-meansï¼ŒEMç®—æ³•å’ŒKNN ç®—æ³•ã€‚">
<meta property="og:image" content="https://ftp.bmp.ovh/imgs/2020/04/c91ebad0e6203aa5.png">
<meta property="og:image" content="https://i.bmp.ovh/imgs/2019/07/8b4f6493ed14471b.png">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/e9a223b5ly1g44zy5fny9j209i08sdh1.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/e9a223b5ly1g44zwyhj76j20fz0av3zf.jpg">
<meta property="article:published_time" content="2020-04-18T12:05:45.000Z">
<meta property="article:modified_time" content="2020-04-21T01:45:05.403Z">
<meta property="article:author" content="Jijeng Jia">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ftp.bmp.ovh/imgs/2020/04/c91ebad0e6203aa5.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/04/18/cluster_algorithm/"/>







<script>
	(function(){
		if(''){
			if (prompt('è¯·è¾“å…¥æ–‡ç« å¯†ç ','') !== ''){
				alert('å¯†ç é”™è¯¯ï¼');
				history.back();
			}
		}
	})();
</script>

  <title>èšç±»ç®—æ³•çš„æ€»ç»“ | Jijeng's blog</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jijeng's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/18/cluster_algorithm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jijeng Jia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jijeng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">èšç±»ç®—æ³•çš„æ€»ç»“</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-04-18T20:05:45+08:00">
                2020-04-18
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-04-21T09:45:05+08:00">
                2020-04-21
              </time>
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/04/18/cluster_algorithm/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2020/04/18/cluster_algorithm/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>ä¸»è¦ä»‹ç»K-meansï¼ŒEMç®—æ³•å’ŒKNN ç®—æ³•ã€‚</p>
<img src="https://ftp.bmp.ovh/imgs/2020/04/c91ebad0e6203aa5.png" width="60%" height="60%">


<a id="more"></a>






<h2 id="K-means-ç®—æ³•"><a href="#K-means-ç®—æ³•" class="headerlink" title="K-means ç®—æ³•"></a>K-means ç®—æ³•</h2><p>K-means æ˜¯ä¸€ç§èšç±»ç®—æ³•ï¼Œå±äºæ— ç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œå…ˆè¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯èšç±»ï¼šèšç±»åˆ†ææ˜¯åœ¨æ•°æ®ä¸­å‘ç°æ•°æ®å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œå°†æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œç»„å†…çš„ç›¸ä¼¼æ€§è¶Šå¤§ï¼Œç»„é—´çš„å·®åˆ«è¶Šå¤§ï¼Œåˆ™èšç±»æ•ˆæœè¶Šå¥½ã€‚</p>
<p>K-Meansç®—æ³•æ€æƒ³ï¼šå¯¹ç»™å®šçš„æ ·æœ¬é›†ï¼Œäº‹å…ˆç¡®å®šèšç±»ç°‡æ•°K ï¼ˆè¶…å‚æ•°ï¼‰ï¼Œè®©ç°‡å†…çš„æ ·æœ¬å°½å¯èƒ½ç´§å¯†åˆ†å¸ƒåœ¨ä¸€èµ·ï¼Œä½¿ç°‡é—´çš„è·ç¦»å°½å¯èƒ½å¤§ã€‚è¯¥ç®—æ³•è¯•å›¾ä½¿é›†ç¾¤æ•°æ®åˆ†ä¸ºnç»„ç‹¬ç«‹æ•°æ®æ ·æœ¬ï¼Œä½¿nç»„é›†ç¾¤é—´çš„æ–¹å·®ç›¸ç­‰ï¼Œæ•°å­¦æè¿°ä¸ºæœ€å°åŒ–æƒ¯æ€§æˆ–é›†ç¾¤å†…çš„å¹³æ–¹å’Œã€‚K-Meansä½œä¸ºæ— ç›‘ç£çš„èšç±»ç®—æ³•ï¼Œå®ç°è¾ƒç®€å•ï¼Œèšç±»æ•ˆæœå¥½ï¼Œå› æ­¤è¢«å¹¿æ³›ä½¿ç”¨ã€‚</p>
<p><strong>ç®—æ³•æ­¥éª¤</strong></p>
<ol>
<li>åˆ›å»ºkä¸ªç‚¹ä½œä¸ºkä¸ªç°‡çš„èµ·å§‹è´¨å¿ƒï¼ˆç»å¸¸éšæœºé€‰æ‹©ï¼‰ã€‚</li>
<li>åˆ†åˆ«è®¡ç®—å‰©ä¸‹çš„å…ƒç´ åˆ°kä¸ªç°‡ä¸­å¿ƒçš„ç›¸å¼‚åº¦ï¼ˆè·ç¦»ï¼‰ï¼Œå°†è¿™äº›å…ƒç´ åˆ†åˆ«åˆ’å½’åˆ°ç›¸å¼‚åº¦æœ€ä½çš„ç°‡ã€‚</li>
<li>æ ¹æ®èšç±»ç»“æœï¼Œé‡æ–°è®¡ç®—kä¸ªç°‡å„è‡ªçš„ä¸­å¿ƒï¼Œè®¡ç®—æ–¹æ³•æ˜¯å–ç°‡ä¸­æ‰€æœ‰å…ƒç´ å„è‡ªç»´åº¦çš„ç®—æœ¯å¹³å‡å€¼ã€‚</li>
<li>å°†Dä¸­å…¨éƒ¨å…ƒç´ æŒ‰ç…§æ–°çš„ä¸­å¿ƒé‡æ–°èšç±»ã€‚</li>
<li>é‡å¤ç¬¬4æ­¥ï¼Œç›´åˆ°èšç±»ç»“æœä¸å†å˜åŒ–ã€‚</li>
<li>æœ€åï¼Œè¾“å‡ºèšç±»ç»“æœã€‚</li>
</ol>
<p><strong>K-Meansç®—æ³•ä¼˜ç¼ºç‚¹</strong></p>
<p>ä¼˜ç‚¹</p>
<ol>
<li>åŸç†æ˜“æ‡‚ã€æ˜“äºå®ç°ï¼›</li>
<li>å½“ç°‡é—´çš„åŒºåˆ«è¾ƒæ˜æ˜¾æ—¶ï¼Œèšç±»æ•ˆæœè¾ƒå¥½ï¼›</li>
<li>Trains quickly</li>
</ol>
<p>ç¼ºç‚¹</p>
<ol>
<li>å½“æ ·æœ¬é›†è§„æ¨¡å¤§æ—¶ï¼Œæ”¶æ•›é€Ÿåº¦ä¼šå˜æ…¢ï¼›</li>
<li>å¯¹å™ªå£°æˆ–è€…ç¦»ç¾¤ç‚¹æ¯”è¾ƒæ•æ„Ÿ</li>
<li>kçš„å–å€¼ååˆ†å…³é”®ï¼Œå¯¹ä¸åŒæ•°æ®é›†ï¼Œké€‰æ‹©æ²¡æœ‰å‚è€ƒæ€§ï¼Œéœ€è¦å¤§é‡å®éªŒ</li>
<li>åˆå§‹è´¨å¿ƒçš„é€‰æ‹©ï¼Œä¸åŒçš„è´¨å¿ƒé€‰æ‹©å¯èƒ½å¾—åˆ°å®Œå…¨ä¸åŒçš„ç»“æœï¼Œå› ä¸ºk-means å¯ä»¥ä¿è¯çš„æ˜¯å±€éƒ¨æœ€ä¼˜è§£ï¼Œè€Œä¸æ˜¯å…¨å±€æœ€ä¼˜è§£ã€‚é’ˆå¯¹è¯¥ç¼ºé™·ï¼Œå¯ä»¥ä½¿ç”¨ kmeans++ ç®—æ³•è§£å†³ã€‚k-means++ ç®—æ³•é€‰æ‹©seedsçš„åŸºæœ¬æ€è·¯æ˜¯ï¼šåˆå§‹åŒ–èšç±»ä¸­å¿ƒä¹‹é—´çš„ç›¸äº’è·ç¦»è¦å°½å¯èƒ½çš„è¿œã€‚</li>
</ol>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong><br>$O(mnkt)$ï¼Œ å…¶ä¸­$t$ ä¸ºè¿­ä»£åˆºæ‰‹ï¼Œ $k$ ä¸ºç°‡çš„æ•°ç›®ï¼Œ $m$ ä¸ºæ•°æ®é‡, $n$ ä¸ºæ•°æ®çš„ç»´åº¦ã€‚å¯¹äºå¤§æ•°æ®æ¥è¯´ï¼Œ$t$ï¼Œ$k$å’Œ$n$ éƒ½æ˜¯å¯ä»¥çœ‹åšå¸¸æ•°ï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦è¿‘ä¼¼å°±æ˜¯ $O(n)$ï¼Œæ‰€ä»¥è¯¥ç®—æ³•æ˜¯ç›¸å½“é«˜æ•ˆçš„ã€‚</p>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong><br>$O(m+k)n$ å…¶ä¸­ $k$ ä¸ºç°‡çš„æ•°ç›®ï¼Œ $m$ä¸ºæ•°æ®é‡ï¼Œ $n$ ä¸ºæ•°æ®çš„ç»´åº¦ã€‚åŒç†å¯¹äºç©ºé—´å¤æ‚åº¦ä¹Ÿå¯ä»¥è¿™æ ·åˆ†æã€‚<br>æœ€åçš„ç»“è®ºå¯ä»¥ç®€åŒ–ä¸ºï¼šæ—¶ç©ºå¤æ‚åº¦æ˜¯$O(n)$</p>
<ul>
<li><p>Hard clustering: Even though some colors near the boundary are pretty similar, but they are grouped into different clusters. No red/green/blue can cross the line.</p>
</li>
<li><p>Means/latent variables: the labels are added manually based on the means (the cross). K-means will end up with bunches of means and assignments, but how to interpret the means are up to people.</p>
</li>
</ul>
<p>You may notice the issues that k-means have:</p>
<ul>
<li>Initialization matters: the same k may end up with different outcomes, because initialization matters. Itâ€™s also important to break the tie.</li>
<li>Unstable under this uniform-ish circumstance. There is no clear structure to divide them into groups.</li>
</ul>
<p><strong>Choosing K</strong></p>
<p>The algorithm explained above finds clusters for the number k that we chose. So, how do we decide on that number?</p>
<p>å°è¯•æ³•ï¼š è®¡ç®—æ¯ä¸ªç‚¹åˆ°æœ€è¿‘çš„ç°‡çš„è·ç¦»çš„æ€»å’Œï¼Œå¦‚æœå¢åŠ  k å¯¼è‡´çš„æ€»å’Œä¸‹é™ä¸æ˜æ˜¾ï¼Œé‚£ä¹ˆå°±æ¥è¿‘ä¸´ç•Œç‚¹äº†ã€‚</p>
<p>To find the best k we need to measure the quality of the clusters. The most traditional and straightforward method is to start with a random k, create centroids, and run the algorithm as we explained above. A sum is given based on the distances between each point and its closest centroid. As an increase in clusters correlates with smaller groupings and distances, this sum will always decrease when k increases; as an extreme example, if we choose a k value that is equal to the number of data points that we have, the sum will be zero.</p>
<p>The goal with this process is to find the point at which increasing k will cause a very small decrease in the error sum, while decreasing k will sharply increase the error sum. This sweet spot is called the â€œelbow point.â€  In the image below, it is clear that the â€œelbowâ€ point is at k-3.Â­</p>
<p><img src="https://i.bmp.ovh/imgs/2019/07/8b4f6493ed14471b.png" alt=""></p>
<p>ä½¿ç”¨åœºæ™¯ï¼šä¸€èˆ¬åœ¨æ•°æ®åˆ†æçš„å‰æœŸä½¿ç”¨ï¼Œé€‰æ‹©é€‚å½“çš„ $K$ï¼Œåˆ†æä¸åŒèšç±»æ•°æ®ä¸‹çš„ç‰¹ç‚¹ã€‚</p>
<p>k-means æ˜¯ä»¥æ¬§å¼è·ç¦»ä½œä¸ºç›¸ä¼¼åº¦æµ‹é‡ï¼Œè¦æ±‚æŸä¸€åˆå§‹åŒ–èšç±»ä¸­å¿ƒåˆ†ç±»æ•ˆæœæœ€å¥½ã€‚ç®—æ³•é‡‡ç”¨è¯¯å·®å¹³æ–¹å’Œä½œä¸ºå‡†ä¾§å‡½æ•°ï¼Œä¼˜åŒ–çš„æ˜¯è¯¥å‡½æ•°ã€‚</p>
<p>æ¬§å¼è·ç¦»å’Œæ›¼å“ˆé¡¿è·ç¦»ï¼ˆL1è·ç¦»ï¼‰éƒ½å¯ä»¥è¡¨ç¤ºæœ€è¿‘é‚»å±…ä¹‹é—´çš„è·ç¦»ï¼Œå¦‚ä½•è¿›è¡Œé€‰æ‹©ï¼Ÿå‰è€…é€‚åˆåœ¨å½’ä¸€åŒ–æ— é‡çº²çš„æƒ…å†µä¸‹è¿›è¡Œä½¿ç”¨ï¼Œä¸¤è€…ä¸å…·æœ‰ç›¸äº’æ›¿ä»£æ€§ã€‚</p>
<p><strong>ä»£ç å®ç°</strong></p>
<p>è‡ªå·±å®ç°äº†ä¸€ä¸ª k-means è®¡ç®—è¿‡ç¨‹ï¼›ç„¶åä½¿ç”¨ sklearn ä¸­å®ç°å¥½çš„æ¡†æ¶ã€‚æ²¡æœ‰æ¯”è¿™ä¸ªå†™å¾—æ›´å¥½çš„äº†ã€‚ä»£ç <a href="http://benalexkeen.com/k-means-clustering-in-python/" target="_blank" rel="noopener">é“¾æ¥</a></p>
<p>ä»£ç æ‘˜è¦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Initialisation</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">'x'</span>: [<span class="number">12</span>, <span class="number">20</span>, <span class="number">28</span>, <span class="number">18</span>, <span class="number">29</span>, <span class="number">33</span>, <span class="number">24</span>, <span class="number">45</span>, <span class="number">45</span>, <span class="number">52</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">55</span>, <span class="number">53</span>, <span class="number">55</span>, <span class="number">61</span>, <span class="number">64</span>, <span class="number">69</span>, <span class="number">72</span>],</span><br><span class="line">    <span class="string">'y'</span>: [<span class="number">39</span>, <span class="number">36</span>, <span class="number">30</span>, <span class="number">52</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">55</span>, <span class="number">59</span>, <span class="number">63</span>, <span class="number">70</span>, <span class="number">66</span>, <span class="number">63</span>, <span class="number">58</span>, <span class="number">23</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">19</span>, <span class="number">7</span>, <span class="number">24</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">200</span>)</span><br><span class="line">k = <span class="number">3</span></span><br><span class="line"><span class="comment"># centroids[i] = [x, y]</span></span><br><span class="line"><span class="comment"># å­¦ä¹ å¼€æºä»£ç ï¼Œåœ¨äºå‘åˆ«äººå­¦ä¹ ï¼Œçœ‹äººå®¶æ˜¯å¦‚ä½•å†™ä»£ç çš„ï¼Œæ€ä¹ˆå†™å¾—ç®€å•é«˜æ•ˆï¼Œæ¼‚äº®</span></span><br><span class="line">centroids = &#123;</span><br><span class="line">    i+<span class="number">1</span>: [np.random.randint(<span class="number">0</span>, <span class="number">80</span>), np.random.randint(<span class="number">0</span>, <span class="number">80</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(k)</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">fig = plt.figure(figsize=(<span class="number">5</span>, <span class="number">5</span>))</span><br><span class="line">plt.scatter(df[<span class="string">'x'</span>], df[<span class="string">'y'</span>], color=<span class="string">'k'</span>)</span><br><span class="line">colmap = &#123;<span class="number">1</span>: <span class="string">'r'</span>, <span class="number">2</span>: <span class="string">'g'</span>, <span class="number">3</span>: <span class="string">'b'</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> centroids.keys():</span><br><span class="line">    plt.scatter(*centroids[i], color=colmap[i])</span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">80</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">80</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assignment</span><span class="params">(df, centroids)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> centroids.keys():</span><br><span class="line">        <span class="comment"># sqrt((x1 - x2)^2 - (y1 - y2)^2)</span></span><br><span class="line">        df[<span class="string">'distance_from_&#123;&#125;'</span>.format(i)] = (</span><br><span class="line">            np.sqrt(</span><br><span class="line">                (df[<span class="string">'x'</span>] - centroids[i][<span class="number">0</span>]) ** <span class="number">2</span></span><br><span class="line">                + (df[<span class="string">'y'</span>] - centroids[i][<span class="number">1</span>]) ** <span class="number">2</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    centroid_distance_cols = [<span class="string">'distance_from_&#123;&#125;'</span>.format(i) <span class="keyword">for</span> i <span class="keyword">in</span> centroids.keys()]</span><br><span class="line">    df[<span class="string">'closest'</span>] = df.loc[:, centroid_distance_cols].idxmin(axis=<span class="number">1</span>)<span class="comment">#å¾—åˆ°çš„æ˜¯id æ ‡è¯†</span></span><br><span class="line">    df[<span class="string">'closest'</span>] = df[<span class="string">'closest'</span>].map(<span class="keyword">lambda</span> x: int(x.lstrip(<span class="string">'distance_from_'</span>))) <span class="comment"># è¿™ä¸ªè½¬æ¢æˆæ•°å­—</span></span><br><span class="line">    df[<span class="string">'color'</span>] = df[<span class="string">'closest'</span>].map(<span class="keyword">lambda</span> x: colmap[x]) <span class="comment"># æ³¨æ„lambda å‡½æ•° x æ˜¯è¾“å…¥å‚æ•°ï¼Œ: ä¹‹åæ˜¯å¤„ç†çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line">df = assignment(df, centroids)</span><br><span class="line">print(df.head())</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Update Stage</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">old_centroids = copy.deepcopy(centroids)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(k)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> centroids.keys():</span><br><span class="line">        centroids[i][<span class="number">0</span>] = np.mean(df[df[<span class="string">'closest'</span>] == i][<span class="string">'x'</span>])</span><br><span class="line">        centroids[i][<span class="number">1</span>] = np.mean(df[df[<span class="string">'closest'</span>] == i][<span class="string">'y'</span>])</span><br><span class="line">    <span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line">centroids = update(centroids)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªå¯è§†åŒ–çš„ç®­å¤´ä¹Ÿæ˜¯åšå¾—ç›¸å½“çš„æ£’</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">5</span>, <span class="number">5</span>))</span><br><span class="line">ax = plt.axes()</span><br><span class="line">plt.scatter(df[<span class="string">'x'</span>], df[<span class="string">'y'</span>], color=df[<span class="string">'color'</span>], alpha=<span class="number">0.5</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> centroids.keys():</span><br><span class="line">    plt.scatter(*centroids[i], color=colmap[i])</span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">80</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">80</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> old_centroids.keys():</span><br><span class="line">    old_x = old_centroids[i][<span class="number">0</span>]</span><br><span class="line">    old_y = old_centroids[i][<span class="number">1</span>]</span><br><span class="line">    dx = (centroids[i][<span class="number">0</span>] - old_centroids[i][<span class="number">0</span>]) * <span class="number">0.75</span></span><br><span class="line">    dy = (centroids[i][<span class="number">1</span>] - old_centroids[i][<span class="number">1</span>]) * <span class="number">0.75</span></span><br><span class="line">    ax.arrow(old_x, old_y, dx, dy, head_width=<span class="number">2</span>, head_length=<span class="number">3</span>, fc=colmap[i], ec=colmap[i])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Continue until all assigned categories don't change any more</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    closest_centroids = df[<span class="string">'closest'</span>].copy(deep=<span class="literal">True</span>)</span><br><span class="line">    centroids = update(centroids)</span><br><span class="line">    df = assignment(df, centroids)</span><br><span class="line">    <span class="comment"># ä¸åŒçš„è¯­è¨€ä¹‹é—´æ˜¯ç›¸åŒçš„ï¼Œè¦ä¹ˆæ˜¯å€¼æ¯”è¾ƒï¼Œé‚£ä¹ˆæ˜¯å¼•ç”¨æ¯”è¾ƒï¼Œæ˜¾ç„¶è¿™é‡Œæ˜¯å€¼æ¯”è¾ƒ</span></span><br><span class="line">    <span class="keyword">if</span> closest_centroids.equals(df[<span class="string">'closest'</span>]):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">5</span>, <span class="number">5</span>))</span><br><span class="line">plt.scatter(df[<span class="string">'x'</span>], df[<span class="string">'y'</span>], color=df[<span class="string">'color'</span>], alpha=<span class="number">0.5</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> centroids.keys():</span><br><span class="line">    plt.scatter(*centroids[i], color=colmap[i]) <span class="comment"># å¦‚æ„å¯ä»¥ä¼ å…¥ä¸€ä¸ªlistï¼Œè¡¨ç¤ºä¸¤ä¸ªå‚æ•°</span></span><br><span class="line">plt.xlim(<span class="number">0</span>, <span class="number">80</span>)</span><br><span class="line">plt.ylim(<span class="number">0</span>, <span class="number">80</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<h2 id="EM-ç®—æ³•"><a href="#EM-ç®—æ³•" class="headerlink" title="EM ç®—æ³•"></a>EM ç®—æ³•</h2><p><strong>å…ˆéªŒæ¦‚ç‡å’ŒåéªŒæ¦‚ç‡</strong></p>
<p>äº‹ä»¶å‘ç”Ÿå‰çš„é¢„åˆ¤æ¦‚ç‡ã€‚å¯ä»¥æ˜¯åŸºäºå†å²æ•°æ®çš„ç»Ÿè®¡ï¼Œå¯ä»¥ç”±èƒŒæ™¯å¸¸è¯†å¾—å‡ºï¼Œä¹Ÿå¯ä»¥æ˜¯äººçš„ä¸»è§‚è§‚ç‚¹ç»™å‡ºã€‚ä¸€èˆ¬éƒ½æ˜¯å•ç‹¬äº‹ä»¶æ¦‚ç‡ï¼Œå¦‚ $P(x) $, $P(y)$ã€‚äº‹ä»¶å‘ç”Ÿåæ±‚çš„åå‘æ¡ä»¶æ¦‚ç‡ï¼›æˆ–è€…è¯´ï¼ŒåŸºäºå…ˆéªŒæ¦‚ç‡æ±‚å¾—çš„åå‘æ¡ä»¶æ¦‚ç‡ã€‚æ¡ä»¶æ¦‚ç‡ï¼šä¸€ä¸ªäº‹ä»¶å‘ç”Ÿåå¦ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡ã€‚</p>
<p>å…ˆéªŒæ¦‚ç‡æ˜¯æŒ‡æ ¹æ®ä»¥å¾€ç»éªŒå’Œåˆ†æå¾—åˆ°çš„æ¦‚ç‡,å®ƒå¾€å¾€ä½œä¸ºâ€ç”±å› æ±‚æœâ€é—®é¢˜ä¸­çš„â€å› â€å‡ºç°ï¼Œæ¯”å¦‚å…¨æ¦‚ç‡å…¬å¼ã€‚</p>
<p>åéªŒæ¦‚ç‡æ˜¯æŒ‡ä¾æ®å¾—åˆ°â€ç»“æœâ€ä¿¡æ¯æ‰€è®¡ç®—å‡ºçš„æœ€æœ‰å¯èƒ½æ˜¯é‚£ç§äº‹ä»¶å‘ç”Ÿ,å¦‚è´å¶æ–¯å…¬å¼ä¸­çš„,æ˜¯â€æ‰§æœå¯»å› â€é—®é¢˜ä¸­çš„â€å› â€ï¼Œ æ¯”å¦‚è´å¶æ–¯å…¬å¼ã€‚</p>
<p><strong>æå¤§ä¼¼ç„¶ä¼°è®¡</strong></p>
<p>æå¤§ä¼¼ç„¶ä¼°è®¡æ˜¯ç”¨æ¥æ±‚è§£æ¦‚ç‡åˆ†å¸ƒä¸­å‚æ•°å€¼ã€‚ä¸ºä»€ä¹ˆè¦æ±‚è§£å‚æ•°å€¼ï¼Ÿå› ä¸ºå¤§å¤šæ•°æ¦‚ç‡åˆ†å¸ƒéƒ½æ˜¯ç”±å…³é”®çš„å‚æ•°å€¼ï¼Œ å¾—åˆ°åˆ†å¸ƒå°±å¯ä»¥è®¡ç®—æ¦‚ç‡å€¼ï¼Œé‚£ä¹ˆè¿›è¡Œåˆ†ç±»å’Œå›å½’å°±æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚å¸¸è§çš„æ¦‚ç‡åˆ†å¸ƒæ¯”å¦‚äºŒé¡¹åˆ†å¸ƒæ˜¯ç”± $p $æ§åˆ¶ï¼Œæ­£å¤ªåˆ†å¸ƒæ˜¯ç”± $\mu$  å’Œ$\sigma$æ§åˆ¶ã€‚æå¤§ä¼¼ç„¶ä¼°è®¡ç†è®ºè®¤ä¸ºï¼Œæ¦‚ç‡è¶Šå¤§ï¼Œå‘ç”Ÿçš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚</p>
<p>è¯¥ç®—æ³•èƒŒæ™¯ï¼š</p>
<ol>
<li>æœ‰ä¸€ä¸ªç‹¬ç«‹åŒåˆ†å¸ƒçš„æ ·æœ¬é›† Dï¼Œä¸”æ ·æœ¬ä»æ•°æ®åˆ†å¸ƒ $p(x | \theta)$ ä¸­æŠ½å–</li>
<li>æƒ³è¦è®¡ç®— $\theta$</li>
</ol>
<p>è§£å†³æ€è·¯ï¼š</p>
<ol>
<li><p>å‡è®¾ D ä¸­æ‰€æœ‰çš„æ ·æœ¬éƒ½æ˜¯ç‹¬ç«‹ä» $ p(x | \theta)$ ä¸­æŠ½å–ï¼Œé‚£ä¹ˆï¼š<br>$$<br>P({X=x^{1}, X=x^{2}, \cdots, X=x^{n}})=\prod_{i=1}^{n} p(x^{i} | {\theta})<br>$$<br>è®°ç­‰å·åé¢çš„å¼å­ä¸ºä¼¼ç„¶å‡½æ•°</p>
</li>
<li><p>å› ä¸ºä¹˜ç§¯ä¸æ–¹ä¾¿å¤„ç†ï¼Œæ‰€ä»¥ä¸Šé¢å¼å­ä¸­å·¦å³ä¸¤è¾¹æ±‚å¯¹æ•°</p>
</li>
</ol>
<p>$$<br>\ln l(\boldsymbol{\theta})=\ln \prod_{i=1}^{n} p\left(x^{i} | \boldsymbol{\theta}\right)=\sum_{i=1}^{n} \ln p\left(x^{i} | \boldsymbol{\theta}\right)<br>$$</p>
<p>æ ¹æ®ç®—æ³•çš„æ€æƒ³ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æœ€å¤§åŒ– $L(\theta)$ï¼Œ æœ€å¤§åŒ–çš„ $\theta$ å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„ã€‚å¦‚ä½•æœ€å¤§åŒ– $L(\theta)$ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœå¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ¯”å¦‚äºŒé¡¹åˆ†å¸ƒï¼Œé‚£ä¹ˆæ±‚å¯¼ä»¤å¯¼æ•°ä¸º0 å°±å¯ä»¥æ±‚$\theta$ã€‚å¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œæ¯”å¦‚æ­£å¤ªåˆ†å¸ƒï¼Œé‚£ä¹ˆå°±éœ€è¦æ±‚è§£åå¯¼ï¼Œ ä»¤åå¯¼æ•°ä¸º0.</p>
<p>æå¤§ä¼¼ç„¶ä¼°è®¡çš„å±€é™æ€§</p>
<ul>
<li>éœ€è¦äº‹å…ˆå‡å®šæ•°æ®åˆ†å¸ƒ</li>
<li>å‡å®šçš„æ•°æ®åˆ†å¸ƒå’ŒçœŸå®çš„æ•°æ®åˆ†å¸ƒä¸ä¸€è‡´çš„æ—¶å€™ï¼Œå®¹æ˜“å‡ºç°è¾ƒå¤§çš„è¯¯å·®</li>
</ul>
<p>ä»‹ç»å®Œäº†æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼Œé‚£ä¹ˆåé¢æ˜¯çœŸæ­£ EM ï¼ˆExpectation Maximization Algorithmï¼‰ç®—æ³•ã€‚</p>
<p>EMç®—æ³•è§£å†³è¿™ä¸ªçš„æ€è·¯æ˜¯ä½¿ç”¨å¯å‘å¼çš„è¿­ä»£æ–¹æ³•ï¼Œæ—¢ç„¶æˆ‘ä»¬æ— æ³•ç›´æ¥æ±‚å‡ºæ¨¡å‹åˆ†å¸ƒå‚æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆçŒœæƒ³éšå«æ•°æ®ï¼ˆEMç®—æ³•çš„Eæ­¥ï¼‰ï¼Œæ¥ç€åŸºäºè§‚å¯Ÿæ•°æ®å’ŒçŒœæµ‹çš„éšå«æ•°æ®ä¸€èµ·æ¥æå¤§åŒ–å¯¹æ•°ä¼¼ç„¶ï¼Œæ±‚è§£æˆ‘ä»¬çš„æ¨¡å‹å‚æ•°ï¼ˆEMç®—æ³•çš„Mæ­¥)ã€‚ç”±äºæˆ‘ä»¬ä¹‹å‰çš„éšè—æ•°æ®æ˜¯çŒœæµ‹çš„ï¼Œæ‰€ä»¥æ­¤æ—¶å¾—åˆ°çš„æ¨¡å‹å‚æ•°ä¸€èˆ¬è¿˜ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚ä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬åŸºäºå½“å‰å¾—åˆ°çš„æ¨¡å‹å‚æ•°ï¼Œç»§ç»­çŒœæµ‹éšå«æ•°æ®ï¼ˆEMç®—æ³•çš„Eæ­¥ï¼‰ï¼Œç„¶åç»§ç»­æå¤§åŒ–å¯¹æ•°ä¼¼ç„¶ï¼Œæ±‚è§£æˆ‘ä»¬çš„æ¨¡å‹å‚æ•°ï¼ˆEMç®—æ³•çš„Mæ­¥)ã€‚ä»¥æ­¤ç±»æ¨ï¼Œä¸æ–­çš„è¿­ä»£ä¸‹å»ï¼Œç›´åˆ°æ¨¡å‹åˆ†å¸ƒå‚æ•°åŸºæœ¬æ— å˜åŒ–ï¼Œç®—æ³•æ”¶æ•›ï¼Œæ‰¾åˆ°åˆé€‚çš„æ¨¡å‹å‚æ•°ã€‚ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºï¼ŒEMç®—æ³•æ˜¯è¿­ä»£æ±‚è§£æœ€å¤§å€¼çš„ç®—æ³•ï¼ŒåŒæ—¶ç®—æ³•åœ¨æ¯ä¸€æ¬¡è¿­ä»£æ—¶åˆ†ä¸ºä¸¤æ­¥ï¼ŒEæ­¥å’ŒMæ­¥ã€‚ä¸€è½®è½®è¿­ä»£æ›´æ–°éšå«æ•°æ®å’Œæ¨¡å‹åˆ†å¸ƒå‚æ•°ï¼Œç›´åˆ°æ”¶æ•›ï¼Œå³å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„æ¨¡å‹å‚æ•°ã€‚ä¸€ä¸ªæœ€ç›´è§‚äº†è§£EMç®—æ³•æ€è·¯çš„æ˜¯K-Meansç®—æ³•ï¼Œè§ä¹‹å‰å†™çš„K-Meansèšç±»ç®—æ³•åŸç†ã€‚åœ¨K-Meansèšç±»æ—¶ï¼Œæ¯ä¸ªèšç±»ç°‡çš„è´¨å¿ƒæ˜¯éšå«æ•°æ®ã€‚æˆ‘ä»¬ä¼šå‡è®¾$ğ¾$ä¸ªåˆå§‹åŒ–è´¨å¿ƒï¼Œå³EMç®—æ³•çš„Eæ­¥ï¼›ç„¶åè®¡ç®—å¾—åˆ°æ¯ä¸ªæ ·æœ¬æœ€è¿‘çš„è´¨å¿ƒï¼Œå¹¶æŠŠæ ·æœ¬èšç±»åˆ°æœ€è¿‘çš„è¿™ä¸ªè´¨å¿ƒï¼Œå³EMç®—æ³•çš„Mæ­¥ã€‚é‡å¤è¿™ä¸ªEæ­¥å’ŒMæ­¥ï¼Œç›´åˆ°è´¨å¿ƒä¸å†å˜åŒ–ä¸ºæ­¢ï¼Œè¿™æ ·å°±å®Œæˆäº†K-Meansèšç±»ã€‚</p>
<ol>
<li><p>EMç®—æ³•èƒ½ä¿è¯æ”¶æ•›å—ï¼Ÿ<br>æœ‰å……åˆ†çš„ç†è®ºè¯´æ˜ï¼Œè¿™ä¸ªæ˜¯èƒ½å¤Ÿä¿è¯æ”¶æ•›çš„ã€‚</p>
</li>
<li><p>EMç®—æ³•å¦‚æœæ”¶æ•›ï¼Œé‚£ä¹ˆèƒ½ä¿è¯æ”¶æ•›åˆ°å…¨å±€æœ€å¤§å€¼å—ï¼Ÿ<br>ä¸èƒ½ä¿è¯ï¼Œè¿™ä¸ªå–å†³äºåˆå§‹åŒ–ã€‚åˆå§‹å€¼ä¸åŒï¼Œé‚£ä¹ˆæœ€åçš„ç»“æœä¸åŒã€‚æ‰€ä»¥è¿™ä¸ªæ˜¯ç»™å®šåˆå§‹å€¼ï¼Œç»è¿‡å¾ªç¯è¿­ä»£ï¼Œæœ€ç»ˆé€¼è¿‘çœŸå®å€¼ã€‚</p>
</li>
</ol>
<p>å¦‚æœè¦è®²è§£ EM ç®—æ³•ï¼Œå¯ä»¥è®¤ä¸º K-means æ˜¯å…¶ä¸€ä¸ªç‰¹ä¾‹ï¼Œé‚£ä¹ˆè¿›è¡Œç†è§£ã€‚</p>
<p>PROPERTIES</p>
<ul>
<li>Soft clustering: can cluster data with no clear group structure; easy to interpret responsibility as probability or componence percentage.</li>
<li>Convergence: non-decreasing log likelihood indicates that with more iterations, EM is guaranteed to get a better result. I.e., it is guaranteed to converge to one of local optima.</li>
<li>More computation &amp; risks:<br>It requires moooore computation than k-means, moooore iterations to converge, but<br>still possible to get stuck in local optima. When that happens, there is something you can do:</li>
<li>Cry</li>
<li>Random restart</li>
</ul>
<p>Relationship btwn k-means &amp; EM</p>
<blockquote>
<p>There is a close similarity between k-means algorithm and EM algorithm for GMM. The first way to understand is from the two-stage update process. Both of the algorithms share an expectation stage and a maximization stage.<br>The second way is we can derive the k-means as a particular limit EM for GMM. The key is to make the soft assignment to be a hard one. We can simply use a \arg \max  to force the probabilities to be binary, or consider a GMM setting with covariance matrix to be $\epsilon$ I where $\lim\epsilon \rightarrow 0$.</p>
</blockquote>
<h2 id="KNN"><a href="#KNN" class="headerlink" title="KNN"></a>KNN</h2><p>Kæœ€è¿‘é‚»(k-Nearest Neighborï¼ŒKNN) æ˜¯æœ‰ç›‘ç£åˆ†ç±»å­¦ä¹ ï¼Œæ ¹æ®K ä¸ªæœ€è¿‘é‚»çš„ç±»åˆ«ä¿¡æ¯ï¼Œé€šè¿‡æŠ•ç¥¨çš„æ–¹å¼å†³å®šåˆšè¿›æ¥çš„æ•°æ®ç‚¹çš„ç±»åˆ«ã€‚å’ŒKNN å®¹æ˜“ç›¸æ··æ·†çš„æ˜¯K-meansç®—æ³•ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸Šé¢çš„æè¿°ã€‚KNN ä¸­çš„K è¡¨ç¤ºKä¸ªæœ€è¿‘é‚»æ˜¯æœ‰æŠ•ç¥¨æƒçš„ï¼Œæ ¹æ®K ä¸ªæœ€è¿‘é‚»çš„æŠ•ç¥¨ç„¶åå†³å®šæ–°åŠ å…¥çš„ç‚¹ç±»åˆ«ä¿¡æ¯ã€‚</p>
<p>In short, the algorithms are trying to accomplish different goals. K-nearest neighbor is a subset of supervised learning classification (or regression) algorithms (it takes a bunch of labeled points and uses them to learn how to label other points). It is supervised because you are trying to classify a point based on the known classification of other points. In contrast, K-means is a subset of unsupervised learning clustering algorithms (it takes a bunch of unlabeled points and tries to group them into clusters). It is unsupervised because the points have no external classification.</p>
<p>The $ k $ in each case mean different things. In K-NN, the $ k $ represents the number of neighbors who have a vote in determining a new playerâ€™s position. The $ k $ in K-means, determine the number of clusters we want to end up.</p>
<p>In a K-NN algorithm, a test sample is given as the class of majority of its nearest neighbours. For example, if we have three classes and the goal is to find a class label for the unknown example $ x_j $ then, by using the Euclidean distance and a value of $ k=5 $ neighbors, the unknown sample is classified to the category of the most voted neighbors.</p>
<blockquote>
<p>How it works?<br>Step 1: Determine the value for K<br>Step 2: Calculate the distances between the new input (test data) and all the training data. The most commonly used metrics for calculating distance are Euclidean, Manhattan and Minkowski<br>Step 3: Sort the distance and determine k nearest neighbors based on minimum distance values<br>Step 4: Analyze the category of those neighbors and assign the category for the test data based on majority vote<br>Step 5: Return the predicted class</p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/e9a223b5ly1g44zy5fny9j209i08sdh1.jpg" alt=""></p>
<p>The situation with K-means is that, given some data you will cluster them in k-groups or clusters. The initial step of the algorithm is to randomly spawn $ k $ centroids (centers). At every iteration the center of each cluster is moved slightly to minimize the objective function. The algorithm will terminate if the iterations are maximized or if the centroids stop to move.</p>
<p>The objective function of K-means is $ J = \sum_{j=1}^{k}\sum_{i=1}^{n}\left |x_i^{j}-c_j  \right |^{2} $</p>
<blockquote>
<p>How it works?<br>Step 1: Determine K value by Elbow method and specify the number of clusters K<br>Step 2: Randomly assign each data point to a cluster<br>Step 3: Determine the cluster centroid coordinates<br>Step 4: Determine the distances of each data point to the centroids and re-assign each point to the closest cluster centroid based upon minimum distance<br>Step 5: Calculate cluster centroids again<br>Step 6: Repeat steps 4 and 5 until we reach global optima where no improvements are possible and no switching of data points from one cluster to other.</p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/e9a223b5ly1g44zwyhj76j20fz0av3zf.jpg" alt=""></p>
<p>ã€€ä¸Šå›¾aè¡¨è¾¾äº†åˆå§‹çš„æ•°æ®é›†ï¼Œå‡è®¾k=2ã€‚åœ¨å›¾bä¸­ï¼Œæˆ‘ä»¬éšæœºé€‰æ‹©äº†ä¸¤ä¸ªkç±»æ‰€å¯¹åº”çš„ç±»åˆ«è´¨å¿ƒï¼Œå³å›¾ä¸­çš„çº¢è‰²è´¨å¿ƒå’Œè“è‰²è´¨å¿ƒï¼Œç„¶ååˆ†åˆ«æ±‚æ ·æœ¬ä¸­æ‰€æœ‰ç‚¹åˆ°è¿™ä¸¤ä¸ªè´¨å¿ƒçš„è·ç¦»ï¼Œå¹¶æ ‡è®°æ¯ä¸ªæ ·æœ¬çš„ç±»åˆ«ä¸ºå’Œè¯¥æ ·æœ¬è·ç¦»æœ€å°çš„è´¨å¿ƒçš„ç±»åˆ«ï¼Œå¦‚å›¾cæ‰€ç¤ºï¼Œç»è¿‡è®¡ç®—æ ·æœ¬å’Œçº¢è‰²è´¨å¿ƒå’Œè“è‰²è´¨å¿ƒçš„è·ç¦»ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ‰€æœ‰æ ·æœ¬ç‚¹çš„ç¬¬ä¸€è½®è¿­ä»£åçš„ç±»åˆ«ã€‚æ­¤æ—¶æˆ‘ä»¬å¯¹æˆ‘ä»¬å½“å‰æ ‡è®°ä¸ºçº¢è‰²å’Œè“è‰²çš„ç‚¹åˆ†åˆ«æ±‚å…¶æ–°çš„è´¨å¿ƒï¼Œå¦‚å›¾4æ‰€ç¤ºï¼Œæ–°çš„çº¢è‰²è´¨å¿ƒå’Œè“è‰²è´¨å¿ƒçš„ä½ç½®å·²ç»å‘ç”Ÿäº†å˜åŠ¨ã€‚å›¾eå’Œå›¾fé‡å¤äº†æˆ‘ä»¬åœ¨å›¾cå’Œå›¾dçš„è¿‡ç¨‹ï¼Œå³å°†æ‰€æœ‰ç‚¹çš„ç±»åˆ«æ ‡è®°ä¸ºè·ç¦»æœ€è¿‘çš„è´¨å¿ƒçš„ç±»åˆ«å¹¶æ±‚æ–°çš„è´¨å¿ƒã€‚æœ€ç»ˆæˆ‘ä»¬å¾—åˆ°çš„ä¸¤ä¸ªç±»åˆ«å¦‚å›¾fã€‚</p>
<p>èšç±»ç®—æ³•æ˜¯æœ€å¸¸è§çš„æ— ç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œè€ŒK-Meansç®—æ³•æ˜¯æœ€å¸¸è§çš„èšç±»ç®—æ³•</p>
<p>EMç®—æ³•æ˜¯ä¸€ä¸ªè¿­ä»£å¼çš„ç®—æ³•ï¼Œåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šEæ­¥å’ŒMæ­¥ï¼›EMç®—æ³•ä¹Ÿå¯ä»¥è§†ä¸ºå°†ç›®æ ‡å‡½æ•°ä½œåæ ‡ä¸Šå‡çš„è¿‡ç¨‹ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æ˜¯å›ºå®šä¸€ä¸ªå‚æ•°å¹¶ä¼°è®¡å¦ä¸€ä¸ªå‚æ•°</p>
<p>EMç®—æ³•å’ŒK-Meansç®—æ³•çš„è¿­ä»£è¿‡ç¨‹æ¯”è¾ƒç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯K-Meansç®—æ³•ä¸­æ¯æ¬¡å¯¹å‚æ•°çš„æ›´æ–°æ˜¯ç¡¬çŒœæµ‹ï¼Œè€ŒEMä¸­æ¯æ¬¡å¯¹å‚æ•°çš„æ›´æ–°æ˜¯è½¯çŒœæµ‹ï¼›ç›¸åŒçš„æ˜¯ï¼Œä¸¤ä¸ªç®—æ³•éƒ½å¯èƒ½å¾—åˆ°å±€éƒ¨æœ€ä¼˜è§£ï¼Œé‡‡ç”¨ä¸åŒçš„åˆå§‹å‚æ•°è¿­ä»£ä¼šæœ‰åˆ©äºå¾—åˆ°å…¨å±€æœ€ä¼˜è§£</p>
<p><a href="https://www.cs.toronto.edu/~jlucas/teaching/csc411/lectures/tut8_handout.pdf" target="_blank" rel="noopener">Clustering, K-Means, EM Tutorial </a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/10/%E5%85%B3%E4%BA%8E%E6%9C%AC%E4%B8%93%E4%B8%9A%E6%96%B9%E9%9D%A2%E7%9A%84%E9%97%B2%E8%AE%B0/" rel="next" title="é—²è®°">
                <i class="fa fa-chevron-left"></i> é—²è®°
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/04/18/super_resolution/" rel="prev" title="å…³äº super resolution çš„ç›¸å…³è®ºæ–‡">
                å…³äº super resolution çš„ç›¸å…³è®ºæ–‡ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="Jijeng Jia" />
            
              <p class="site-author-name" itemprop="name">Jijeng Jia</p>
              <p class="site-description motion-element" itemprop="description">Solving Problems by Coding</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">156</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">85</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/jijeng" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:jia1509309698@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          <script type="text/javascript" src="//rf.revolvermaps.com/0/0/5.js?i=5kk0u0mm50w&amp;m=0&amp;c=54ff00&amp;cr1=ff0000" async="async"></script>


        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#K-means-ç®—æ³•"><span class="nav-number">1.</span> <span class="nav-text">K-means ç®—æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EM-ç®—æ³•"><span class="nav-number">2.</span> <span class="nav-text">EM ç®—æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KNN"><span class="nav-number">3.</span> <span class="nav-text">KNN</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jijeng Jia</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>

<div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
Total  <span id="busuanzi_value_site_pv"></span> views
You got  <span id="busuanzi_value_site_uv"></span> visitors
</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://https-jijeng-github-io.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2020/04/18/cluster_algorithm/';
          this.page.identifier = '2020/04/18/cluster_algorithm/';
          this.page.title = 'èšç±»ç®—æ³•çš„æ€»ç»“';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://https-jijeng-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  















  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('10');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
